# 数字人骨骼系统规范

## 骨骼系统目标
- 创建高质量的数字人骨骼控制系统
- 实现自然流畅的角色动画效果
- 建立高效的面部表情系统
- 确保实时动画性能

## 技术规范

### 1. 骨骼层级结构
```
root
├── pelvis
│   ├── spine_01
│   │   ├── spine_02
│   │   │   ├── spine_03
│   │   │   │   ├── neck_01
│   │   │   │   │   └── head
│   │   │   ├── clavicle_l
│   │   │   │   └── upperarm_l
│   │   │   │       └── lowerarm_l
│   │   │   │           └── hand_l
│   │   │   └── clavicle_r
│   ├── thigh_l
│   │   └── calf_l
│   │       └── foot_l
│   └── thigh_r
```

### 2. 命名规范
- 左右对称: _l, _r 后缀
- 手指: thumb_01_l, index_01_l
- 脚趾: toe_01_l
- 面部: face_brow_01_l
- 辅助骨骼: aux_spine_01

### 3. 面部骨骼系统
#### 基础骨骼
- 眉毛控制器（每边3-5根）
- 眼睑控制器（每眼4个）
- 嘴角控制器（每边2-3个）
- 下巴控制器
- 舌头骨骼（3-4节）

#### FACS系统
```c#
// 面部动作单元(AU)
AU_01: 眉毛内侧上扬
AU_02: 眉毛外侧上扬
AU_04: 眉毛下降
AU_05: 上眼睑提升
AU_06: 脸颊提升
AU_12: 嘴角上扬
AU_15: 嘴角下垂
AU_26: 下巴下降
```

### 4. 控制器设置
#### 身体控制器
- 全局控制器
- 重心控制器
- 脊柱FK/IK控制器
- 四肢IK控制器
- 手指控制器
- 脚趾控制器

#### 面部控制器
- 主表情控制器
- 眉毛形状控制器
- 眼睛注视控制器
- 嘴型控制器
- 舌头控制器

## 制作流程

### 1. 前期准备
- 检查模型拓扑
- 确认骨骼需求
- 规划控制器系统

### 2. 基础骨骼设置
1. 放置主骨骼
   - 确定关节位置
   - 设置骨骼方向
   - 建立层级关系

2. 设置约束
   - IK约束
   - 旋转约束
   - 父子约束

3. 权重绑定
   - 自动权重生成
   - 手动权重调整
   - 权重平滑处理

### 3. 面部绑定
1. 面部骨骼布置
   - 放置基础骨骼
   - 设置骨骼层级
   - 创建控制器

2. 表情系统设置
   - 创建FACS控制器
   - 设置混合形状
   - 建立驱动关系

### 4. 控制器创建
1. 主控制器
   - 全局控制
   - 姿态控制
   - 附加属性

2. 辅助控制器
   - IK/FK切换
   - 拉伸控制
   - 微调控制

## 测试与优化

### 1. 基础测试
- [ ] 骨骼层级检查
- [ ] 命名规范检查
- [ ] 轴向一致性检查
- [ ] 镜像对称性检查

### 2. 动画测试
- [ ] 基础动作测试
- [ ] 极限动作测试
- [ ] 面部表情测试
- [ ] 权重过渡检查

### 3. 性能优化
- 简化骨骼结构
- 优化约束系统
- 减少变形器使用
- LOD骨骼设置

## 常见问题

### 1. 变形问题
- 关节变形不自然
  - 检查权重分布
  - 调整骨骼位置
  - 添加辅助骨骼

- 面部表情不够灵活
  - 增加控制器自由度
  - 优化混合形状
  - 调整驱动关系

### 2. 技术问题
- 性能开销大
  - 简化骨骼系统
  - 优化约束关系
  - 使用骨骼LOD

- 动画重定向问题
  - 统一骨骼命名
  - 标准化骨骼结构
  - 建立重定向预设

## 工具推荐
- Maya：主要绑定工具
- Advanced Skeleton：绑定插件
- mGear：自动绑定系统
- Face Robot：面部绑定
- Unity/UE：游戏引擎实现

## 参考资源
1. [Advanced Rigging Techniques](https://www.pluralsight.com/courses/advanced-rigging-techniques)
2. [FACS System Guide](https://www.paulekman.com/facial-action-coding-system/)
3. [Game Character Rigging](https://www.unrealengine.com/en-US/blog/creating-believable-characters)

## 更新记录
| 日期 | 版本 | 更新内容 | 更新人 |
|------|------|----------|--------|
| 2025-04-19 | v0.1 | 初始版本 | TA | 
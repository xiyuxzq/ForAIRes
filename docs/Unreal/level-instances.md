# Level Instances 和 Packed Level Actors

## 定义

Level Instance 和 Packed Level Actors 都是"非破坏性"工作流程，允许在同一个世界中实例化内容，各自具有不同的用例和目标。它们不是可覆盖的预制体，但支持通过 Actor Filters（5.3 新功能）进行变体。

### Level Instance (LI)

是一个基于关卡的工作流程，通过将关卡引用到关卡实例演员中，实现预定义演员集的实例化。允许在不退出实例化所在世界的情况下在上下文中编辑它们。

### Packed Level Actor (PLA)

输出一个单独的演员蓝图，仅包含其关联源关卡中所有演员的视觉组件（静态网格体、实例化静态网格体和层次化静态网格体）。

## UE 5.4 重要更新

### 编辑器路径
- 现在可以从持久世界或父级关卡实例引用关卡实例或嵌套关卡实例中的演员
- 编辑器路径在 PIE 和 Cook 过程中的生成流送步骤中自动解析

### 每个关卡实例演员的关卡行为选项
- 嵌入式模式：在生成流送步骤中将所有演员嵌入父世界
- 独立模式：将关卡实例演员视为一个整体

## 最佳实践

1. **创建仅用于制作的游乐场**
   - 创建空的参考游乐场世界
   - 包含游戏的世界光照、后处理等
   - 用于在复杂和重型世界环境之外制作关卡实例/打包关卡演员

2. **使用 Actor Filters 创建变体**
   - 通过 Actor Filters 功能更容易构建具有 2 个或更多配置的关卡实例
   - 适用于静态设置，如照明、装饰集、样式更改或贴花

3. **尽可能打包**
   - 将高密度的静态视觉内容打包成单个优化的演员

## 限制

1. **覆盖**
   - 关卡实例引用源关卡，无法在关卡实例内覆盖演员及其属性
   - 打包关卡演员在每次更新时都会重建（5.3 及之前版本）

2. **不支持关卡蓝图**
   - 由于关卡实例在关卡流送期间被分解，我们不支持关卡实例上的关卡蓝图

3. **编辑器中无部分和异步加载**
   - 当前在编辑器中加载将加载所需区域与关卡实例 BV 交集中的所有内容
   - 关卡实例的加载不是异步的

## 实际应用案例

### Fortnite Chapter 4 和 Chapter 5
- 所有主要位置都使用关卡实例构建
- 每个建筑/房屋/POI 级别的粒度
- 大多数情况下关卡实例是单层深度
- 不使用打包关卡演员，因为 FN 游戏玩法需要每个部分都是独立的演员

### The Matrix Awaken 演示
- 打包关卡演员用于程序化世界生成之外的英雄建筑手工制作
- 打包关卡演员用于创建预制屋顶组件，然后由程序化系统分散
- 所有程序化建筑、道路、屋顶网格、道具都压缩成由 ISM 组件组成的演员

## 未来发展

1. 支持每个关卡实例的演员属性覆盖
2. 编辑器中异步加载
3. 只读选择模式以从外部访问子演员
4. 自定义 HLOD 支持
5. UX 改进（创建唯一/复制、上下文编辑导航、刷新 PLA）
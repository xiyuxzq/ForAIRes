# One File Per Actor (OFPA)

## 定义

One File Per Actor (OFPA) 通过将Actor实例的数据保存在外部文件中来减少用户之间的重叠，消除了在更改Actor时保存主关卡文件的需求。这些外部Actor存储在项目的内容文件夹中，但不能从编辑器内容浏览器访问。

## UE 5.4 重要更新

1. **GUID "美化"修复**
   - 修复了在日志和检查地图中显示 GUID 而不是美化的Actor名称的问题

2. **未控制文件发现修复**
   - 修复了阻止本地编辑文件被发现和列在未控制 CL 中的问题
   - 发现现在在初始资产发现后进行

3. **默认未控制变更列表修复**
   - 修复了默认未控制变更列表无法显示的问题（5.4.2）

## 最佳实践

### 使用 Unreal 的源代码控制/查看变更列表

强烈建议所有 World Partition 用户通过 Unreal 源代码控制集成进行：
- 检出
- 编辑变更列表
- 提交所有数据

原因：
- 外部Actor文件使用 GUID 命名，在外部源代码控制应用程序中难以识别
- Unreal 的查看变更列表窗口显示Actor显示名称、类型和路径
- 未控制 CL 工具在 Unreal 外部不可用
- 提交时进行验证，防止引入数据问题

### 使用未控制 CL

- 查看编辑和可写的文件
- 用于本地工作或处理锁定文件
- 清理工作区中的本地幽灵文件
- 在准备就绪时将编辑从未控制 CL 移动到源代码控制 CL

## 限制

1. **GUID 美化仅在 UE 中可用**
   - GUID 只能在 Unreal 内部转换为其显示名称
   - 可以在场景大纲视图中过滤 GUID

2. **非 OFPA 与 OFPA 关卡实例**
   - 流送行为在非 OFPA 和启用 OFPA 的关卡实例之间不同
   - OFPA 启用 = 在生成流送时（pie 和 cook）关卡实例内容被分解到持久世界中
   - 非 OFPA = 关卡实例在生成流送时保持完整

3. **访问未加载的Actor**
   - 工具和数据驱动实用程序需要获取 ActorDescs 才能找到 GUID
   - 如果关卡编辑器中未加载世界，则无法访问Actor

## 实际应用案例

### Fortnite Chapter 4 和 Chapter 5
- 单个大型世界包含约 10 万个外部Actor
- 全球多用户使用混合提交、代理和边缘服务器
- 多个分支保存相同的内容和文件数量

### Lego Fortnite
- 多个由多个世界分区/ofpa 关卡层组成的图块
- 基于 Mass 框架的内部Actor实例化解决方案

## 未来发展

1. 删除引用提交验证
2. 锁定Actor系统
3. One File Multiple Actor（减少文件管理/数量，同时尽量保持减少文件争用）